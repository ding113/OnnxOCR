services:
  onnx-ocr:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: onnx-ocr-service
    ports:
      - "5005:5005"
    restart: unless-stopped
    volumes:
      # === 核心数据处理目录 ===
      - "./data/logs:/app/logs"                        # 应用运行日志
      - "./data/results:/app/results"                  # 处理结果存储
      - "./data/uploads:/app/uploads"                  # 文件上传缓存
    environment:
      - RUST_LOG=info
      - RUST_BACKTRACE=1
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5005/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    tmpfs:
      - /tmp                   # 临时文件使用内存文件系统，提高性能